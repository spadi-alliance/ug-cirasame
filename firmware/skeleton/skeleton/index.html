
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="CIRASAME User Guide">
      
      
        <meta name="author" content="Ryotaro Honda">
      
      
      
        <link rel="prev" href="../../../hardware/cirasame/cirasame/">
      
      
        <link rel="next" href="../../strlrtdc/strlrtdc/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Skeleton - CIRASAME User Guide</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="lime" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#skeleton-firmware" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="CIRASAME User Guide" class="md-header__button md-logo" aria-label="CIRASAME User Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CIRASAME User Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Skeleton
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/spadi-alliance/ug-cirasame" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ug-cirasame
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Top

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../release/release/" class="md-tabs__link">
        
  
  
    
  
  Release

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../hardware/cirasame/cirasame/" class="md-tabs__link">
          
  
  
  Hardware

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Firmware

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../software/software/" class="md-tabs__link">
        
  
  
    
  
  Software

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../practical/practical/" class="md-tabs__link">
        
  
  
    
  
  Practical Usage

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CIRASAME User Guide" class="md-nav__button md-logo" aria-label="CIRASAME User Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CIRASAME User Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spadi-alliance/ug-cirasame" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ug-cirasame
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hardware
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Hardware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hardware/cirasame/cirasame/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CIRASAME
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Firmware
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Firmware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Skeleton
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Skeleton
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#history" class="md-nav__link">
    <span class="md-ellipsis">
      History
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#led-and-dip-switch" class="md-nav__link">
    <span class="md-ellipsis">
      LED and DIP switch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-bus-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Local bus modules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citiroc-control" class="md-nav__link">
    <span class="md-ellipsis">
      CITIROC Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CITIROC Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citiroc-controller" class="md-nav__link">
    <span class="md-ellipsis">
      CITIROC Controller
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adc-readout" class="md-nav__link">
    <span class="md-ellipsis">
      ADC readout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ADC readout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hold-generator" class="md-nav__link">
    <span class="md-ellipsis">
      Hold Generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad9220" class="md-nav__link">
    <span class="md-ellipsis">
      AD9220
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AD9220">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Data structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mppc-bias-supply" class="md-nav__link">
    <span class="md-ellipsis">
      MPPC bias supply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MPPC bias supply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#max1932-controller" class="md-nav__link">
    <span class="md-ellipsis">
      MAX1932 Controller
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#signal-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Signal selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Signal selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#io-manager" class="md-nav__link">
    <span class="md-ellipsis">
      IO Manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strlrtdc/strlrtdc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StrLRTDC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strlrtdc-10g/strlrtdc-10g/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StrLRTDC-10G
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../software/software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../practical/practical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Practical Usage
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="skeleton-firmware">Skeleton firmware</h1>
<h2 id="overview">Overview</h2>
<p>CIRASAME skeleton is a template firmware including only some basic functions.
It does not contains the functionalities for clock synchronization and data acquisition.
This is basically the same as the AMANEQ skeleton, but it has some dedicated functions for the CIRASAME board.
See also the user guide for the <a href="https://spadi-alliance.github.io/ug-amaneq/firmware/overview/overview/">AMANEQ firmware overview</a> and the <a href="https://spadi-alliance.github.io/ug-amaneq/firmware/skeleton/skeleton/">AMANEQ skeleton</a>.</p>
<p><a href="https://github.com/spadi-alliance/CIRASAME-Skeleton">Github repository</a></p>
<pre><code>- Unique ID:                  0x413E

- Link protocol:              SiTCP
- Default IP:                 192.168.10.16
- Data link speed:            1Gbps
</code></pre>
<h3 id="history">History</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">Version</th>
<th style="text-align: left;">Date</th>
<th style="text-align: left;">Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">v2.0</td>
<td style="text-align: left;">2024.6.4</td>
<td style="text-align: left;">De facto first version</td>
</tr>
</tbody>
</table>
<h2 id="functions">Functions</h2>
<figure id="_figure-1">
<img alt="FW-VIEW" id="FW-VIEW" src="../block-diagram.png" width="80%" />
<figcaption><span>Figure&nbsp;1:</span> Block diagram of skeleton firmware</figcaption>
</figure>
<p>The CIRASAME skeleton firmware includes some dedicated local bus modules for operating MPPCs and CITIROCs in addition to the common modules.
The APD bias IC, MAX1932, is controlled through the MAX1932 Controller.
CITIROCs are controlled by the CITIROC Controller.
To access this module, the dedicated software is necessary. Please see the software section.
The comparator outputs from CITIROCs are connected to the IO manager selecting one of them to output from the NIM-OUT1 output.</p>
<p>For the charge measurement, the CITIROC requires a HOLD signal to keep the signal peak height during the ADC readout process.
The HOLD signal input from the NIM-IN2 is delayed with 2ns steps to adjust the hold timing.
The analog output for high-gain side is fed into AD9220 ADC, and the data digitized are collected by the AD9220 module in FPGA.
ADC data are sent to a PC via not TCP but RBCP in SiTCP.
Since the ADC readout function is independent from the LACCP and the Str-TDC, this is not a part of the DAQ functionalities.
<strong>The developer does not expect that users take ADC data in the physics experiment.</strong>
It is a kind of the debug function.</p>
<p>Please use this firmware for IC initialization, ASIC health checks, etc.</p>
<h3 id="led-and-dip-switch">LED and DIP switch</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">DIP #</th>
<th style="text-align: left;"></th>
<th style="text-align: left;">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;">SiTCP IP setting</td>
<td style="text-align: left;">0: Use default IP <br> 1: Use IP address set by users (License is required).</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;">Not in use</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: left;">Not in use</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: left;">Not in use</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h2 id="local-bus-modules">Local bus modules</h2>
<p>The Str-LRTDC includes 9 local bus modules.
The local bus address map is as follows.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Local Module</th>
<th style="text-align: left;">Address range</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Hold Generator</td>
<td style="text-align: left;">0x1000'0000 - 0x1FFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">AD9220</td>
<td style="text-align: left;">0x2000'0000 - 0x2FFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">CITIROC Controller</td>
<td style="text-align: left;">0x3000'0000 - 0x3FFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">IO Manager</td>
<td style="text-align: left;">0x4000'0000 - 0x4FFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">Scaler</td>
<td style="text-align: left;">0x8000'0000 - 0x8FFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">MAX1932 Controller</td>
<td style="text-align: left;">0x9000'0000 - 0x9FFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">CDCE62002 Controller</td>
<td style="text-align: left;">0xB000'0000 - 0xBFFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">Self Diagnosis System</td>
<td style="text-align: left;">0xC000'0000 - 0xCFFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">Flash Memory Programmer</td>
<td style="text-align: left;">0xD000'0000 - 0xDFFF'0000</td>
</tr>
<tr>
<td style="text-align: left;">Bus Controller</td>
<td style="text-align: left;">0xE000'0000 - 0xEFFF'0000</td>
</tr>
</tbody>
</table>
<h2 id="citiroc-control">CITIROC Control</h2>
<h3 id="citiroc-controller">CITIROC Controller</h3>
<p>The CITIROC has a SPI port for register setting, and the CITIROC Controller provides the SPI data and the clock signal for this port.
Since the SPI ports are connected in series, all the CITIROCs are set to register at once.
Users who are familiar with CITIROC will notice that they can perform register read-back by monitoring the SRO signal, but such a function is not implemented in CIRASAME.</p>
<p>The dedicated software to use the CITIROC Controller is prepared, please use that.
The author feels that it is not realistic to access this module using only write/read_register.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Register name</th>
<th style="text-align: left;">Address</th>
<th style="text-align: center;">Read/Write</th>
<th style="text-align: center;">Bit width</th>
<th style="text-align: left;">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">kAddrSCFIFO</td>
<td style="text-align: left;">0x80000000</td>
<td style="text-align: center;">W</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">Write SPI data to the buffer</td>
</tr>
<tr>
<td style="text-align: left;">kAddrPDC</td>
<td style="text-align: left;">0x80100000</td>
<td style="text-align: center;">W</td>
<td style="text-align: center;">2</td>
<td style="text-align: left;">Update the pin direct control registers</td>
</tr>
<tr>
<td style="text-align: left;">kAddrCC</td>
<td style="text-align: left;">0x80200000</td>
<td style="text-align: center;">W</td>
<td style="text-align: center;">-</td>
<td style="text-align: left;">Start a SPI cycle</td>
</tr>
</tbody>
</table>
<h2 id="adc-readout">ADC readout</h2>
<p>Since the ADC readout function is developed as a debug tool, this function is not well matured.
The J-PARC E50 member can skip this sub-section.
It is designed to collect ADC data with low rate trigger input in a stand-alone mode.
Data taking with multiple boards are not considered since the hardware busy is not implemented.
<strong>The author emphasize that it is a debug tool, please do not use it for physics experiments.</strong></p>
<h3 id="hold-generator">Hold Generator</h3>
<p>The charge measurement method of CITIROC is peak height hold.
Voltage when receiving the HOLD signal is kept in a capacitance in CITIROC, and then stored DC voltage is multiplexed and digitized by AD9220 channel by channel.
To hold the pulse peak position, users need to send the HOLD signal at appropriate timing.
As shown in the <a href="#HOLD-ANALOG">figure</a>, the pulse height is held while the HOLD signal takes a logic high.
Note that only the analog output is affected by the HOLD signal, the slow shaper output from the probe port is not held even you input the HOLD signal because the probe line is branched before the HOLD function.</p>
<figure id="_figure-2">
<img alt="HOLD-ANALOG" id="HOLD-ANALOG" src="../analog-hold.png" width="80%" />
<figcaption><span>Figure&nbsp;2:</span> Analog output with HOLD signal and slow shaper output from probe output.</figcaption>
</figure>
<p>Then, users need to adjust the HOLD signal timing precisely so that the HOLD signal is input just at the pulse peaking timing.
The Hold Generator is used for this purpose, and it can provide 64ns delay amount in maximum with 2ns steps.
This unit has 32-bit length mask register, which determines the delay amount.
The incoming pulse runs from the left side as shown in the <a href="#HOLD-GEN">figure</a>.
When the pulse reaches the bit position where the bit is set to 1, the delayed HOLD signal takes a logic 1.
Please fill 1 continuously from the MSB side of the mask register, and the longer the length of 1 gives the smaller delay amount.</p>
<p>The delayed HOLD signal is then output from the NIM-OUT-2.</p>
<figure id="_figure-3">
<img alt="HOLD-GEN" id="HOLD-GEN" src="../hold-gen.png" width="80%" />
<figcaption><span>Figure&nbsp;3:</span> Relation between delay amount and mask register pattern.</figcaption>
</figure>
<p>The register address map of the Hold Generator is as follows.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Register name</th>
<th style="text-align: left;">Address</th>
<th style="text-align: center;">Read/Write</th>
<th style="text-align: center;">Bit width</th>
<th style="text-align: left;">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">kAddrDelayMask</td>
<td style="text-align: left;">0x10000000</td>
<td style="text-align: center;">R/W</td>
<td style="text-align: center;">32</td>
<td style="text-align: left;">Delay mask register</td>
</tr>
</tbody>
</table>
<h3 id="ad9220">AD9220</h3>
<p>The AD9220 module reads the data from the ADC (AD9220) on the board.
<strong>Note that only the high-gain side can be reed.</strong>
This modules requires the delayed HOLD signal from the Hold Generator.
Please set the mask register to the Hold Generator before accessing this module.
Although the data readout trigger to this module is the HOLD signal, it does not start the data read cycle only with the HOLD signal input.
To start the read cycle, users need to open the daq gate through RBCP.
Thus, the procedure for the ADC data read is as follows.</p>
<ol>
<li>Set and adjust the mask register for the Hold Generator</li>
<li>Open the daq gate</li>
<li>Check the event buffer status</li>
<li>If an event exists, read an event from the buffer</li>
<li>Repeat No.3 and 4</li>
<li>Close the daq gate when stopping data taking</li>
</ol>
<p>The simple software to read ADC data is prepared in cirasame-soft.</p>
<p>The register address map of the AD9220 module is as follows.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Register name</th>
<th style="text-align: left;">Address</th>
<th style="text-align: center;">Read/Write</th>
<th style="text-align: center;">Bit width</th>
<th style="text-align: left;">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">kAddrDaqGate</td>
<td style="text-align: left;">0x20000000</td>
<td style="text-align: center;">R/W</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">DAQ gate bit</td>
</tr>
<tr>
<td style="text-align: left;">kAddrEventFull</td>
<td style="text-align: left;">0x20100000</td>
<td style="text-align: center;">R</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">Flag indicating event existence</td>
</tr>
<tr>
<td style="text-align: left;">kAddrReadFIFO</td>
<td style="text-align: left;">0x21000000</td>
<td style="text-align: center;">R</td>
<td style="text-align: center;">8</td>
<td style="text-align: left;">Data read from the event buffer</td>
</tr>
<tr>
<td style="text-align: left;">kAddrReleaseBusy</td>
<td style="text-align: left;">0x22000000</td>
<td style="text-align: center;">W</td>
<td style="text-align: center;">-</td>
<td style="text-align: left;">Manual busy release. Use this if the read sequencer is dead locked.</td>
</tr>
</tbody>
</table>
<h4 id="data-structure">Data structure</h4>
<p>The data word size is 16 bit.
The data structure is extremely simple, with the ADC data simply arranged in order from channel 0 of ASIC 0.
The 13th bit, the OTR flag, indicates that the ADC has overflowed.
Since the CITIROC has a thermometer connected to channel 33, the number of data words from one ASIC is 33.
In other words, 132 words are read out in one read operation.
No header or trailer is added.
<strong>Please note that the temperature reading here is not correct at all.</strong>
The CIRASAME firmware is not designed to read the CITIROC thermometer.</p>
<pre><code>MSB                                                   LSB
[    3-bit    ][    1-bit    ][        12-bit        ]
  Zero padding       OTR              ADC value

1st word:   CITIROC0 ch0
2nd word:   CITIROC0 ch1
...
33th word:  CITIROC0 thermometer
34th word:  CITIROC1 ch0
35th word:  CITIROC1 ch1
...
132th word: CITIROC3 thermometer
</code></pre>
<h2 id="mppc-bias-supply">MPPC bias supply</h2>
<h3 id="max1932-controller">MAX1932 Controller</h3>
<p>This module provides the SPI interface for a MAC1932 IC, which is a bias supply for MPPCs.
The MAX1932 IC can bias sensors between 40V - 70V with 256 (8-bit) steps.
The register value 1 provides the maximum voltage of 70V, output voltage decreases as a function of the register value.
Note that the maximum voltage is not exactly 70V, and it has board dependence, probably.
If users want to know the exact output voltage, please measure it by a multimeter.
If you set the register value 0, the IC is turned off, and output voltage goes 0V.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Register name</th>
<th style="text-align: left;">Address</th>
<th style="text-align: center;">Read/Write</th>
<th style="text-align: center;">Bit width</th>
<th style="text-align: left;">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">kAddrTxd</td>
<td style="text-align: left;">0x90000000</td>
<td style="text-align: center;">W</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">8-bit register to MAX1923</td>
</tr>
<tr>
<td style="text-align: left;">kAddrExecWrite</td>
<td style="text-align: left;">0x91000000</td>
<td style="text-align: center;">W</td>
<td style="text-align: center;">-</td>
<td style="text-align: left;">Execute SPI sequence</td>
</tr>
</tbody>
</table>
<h2 id="signal-selection">Signal selection</h2>
<h3 id="io-manager">IO Manager</h3>
<p>This modules selects one of the comparator outputs from CITIROCs, and the selected one is output from NIM-OUT-1.
The value set to kAddrSelDiscri represents the selected channel.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Register name</th>
<th style="text-align: left;">Address</th>
<th style="text-align: center;">Read/Write</th>
<th style="text-align: center;">Bit width</th>
<th style="text-align: left;">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">kAddrSelDiscri</td>
<td style="text-align: left;">0x40000000</td>
<td style="text-align: center;">W</td>
<td style="text-align: center;">7</td>
<td style="text-align: left;">7-bit channel number (default: 0x0)</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      KEK IPNS
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.integrate", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>